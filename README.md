# imx-extract-program-image

An "interactive library" (read: I couldn't be bothered to wrap this into a command-line application) for extracting the *Device Configuration Data* from an i.mx boot image. Doesn't handle some of the more esoteric features.

Used to reconstruct the flash headers for the Tolino devices, whose source dump over at [opensource.mytolino.com](https://opensource.mytolino.com/) is horribly outdated and is missing support for the newer models. The output (via the `Show` instances in `ProgramImage.hs`) is a list of DCD commands as accepted by the [imximage](https://github.com/u-boot/u-boot/blob/a314ec1bfda3d0db0ce8ae02dde1b06650d82e7f/tools/imximage.c) tool.

The following is a working imximage.cfg for the Tolino Page. This allows us to run upstream U-Boot!

```
/* Preamble added manually */
IMAGE_VERSION 2
BOOT_FROM sd

DATA 4 0x020c4018 0x00260324

/* I added the following entries manually to get UART to work, since upstream
U-Boot does not disable clock gating. In the vendor version this is done in the
board-specific initialisation routine. */
DATA 4 0x020c4068 0xffffffff
DATA 4 0x020c406c 0xffffffff
DATA 4 0x020c4070 0xffffffff
DATA 4 0x020c4074 0xffffffff
DATA 4 0x020c4078 0xffffffff
DATA 4 0x020c407c 0xffffffff
DATA 4 0x020c4080 0xffffffff

DATA 4 0x020C4018 0x00260324
DATA 4 0x020E0344 0x00000038
DATA 4 0x020E0348 0x00000038
DATA 4 0x020E034C 0x00000038
DATA 4 0x020E0350 0x00000038
DATA 4 0x020E030C 0x00000038
DATA 4 0x020E0310 0x00000038
DATA 4 0x020E0314 0x00000038
DATA 4 0x020E0318 0x00000038
DATA 4 0x020E0300 0x00000038
DATA 4 0x020E031C 0x00000038
DATA 4 0x020E0338 0x00000038
DATA 4 0x020E0320 0x00000038
DATA 4 0x020E032C 0x00000000
DATA 4 0x020E033C 0x00003038
DATA 4 0x020E0340 0x00003038
DATA 4 0x020E05C4 0x00000038
DATA 4 0x020E05CC 0x00000038
DATA 4 0x020E05D4 0x00000038
DATA 4 0x020E05D8 0x00000038
DATA 4 0x020E05AC 0x00000038
DATA 4 0x020E05C8 0x00000038
DATA 4 0x020E05B0 0x00020000
DATA 4 0x020E05B4 0x00000000
DATA 4 0x020E05C0 0x00020000
DATA 4 0x020E05D0 0x000C0000
DATA 4 0x021B0800 0xA1390003
DATA 4 0x021B080C 0x001F001F
DATA 4 0x021B0810 0x001F001F
DATA 4 0x021B083C 0x413C0138
DATA 4 0x021B0840 0x00000000
DATA 4 0x021B0848 0x4040464A
DATA 4 0x021B0850 0x40403636
DATA 4 0x021B081C 0x33333333
DATA 4 0x021B0820 0x33333333
DATA 4 0x021B0824 0x33333333
DATA 4 0x021B0828 0x33333333
DATA 4 0x021B082C 0x00000000
DATA 4 0x021B0830 0x00000000
DATA 4 0x021B0834 0x00000000
DATA 4 0x021B0838 0x00000000
DATA 4 0x021B08C0 0x24911492
DATA 4 0x021B08B8 0x00000800
DATA 4 0x021B0004 0x00020024
DATA 4 0x021B0008 0x1B333040
DATA 4 0x021B000C 0x69435313
DATA 4 0x021B0010 0xB68E0B63
DATA 4 0x021B0014 0x01FF00DB
DATA 4 0x021B0018 0x00001780
DATA 4 0x021B001C 0x00008000
DATA 4 0x021B002C 0x000026D2
DATA 4 0x021B0030 0x00431023
DATA 4 0x021B0040 0x0000004F
DATA 4 0x021B0404 0x00011006
DATA 4 0x021B0000 0x84180000
DATA 4 0x021B001C 0x04408032
DATA 4 0x021B001C 0x00008033
DATA 4 0x021B001C 0x00048031
DATA 4 0x021B001C 0x05208030
DATA 4 0x021B001C 0x04008040
DATA 4 0x021B0020 0x00005800
DATA 4 0x021B0818 0x00011117
DATA 4 0x021B0004 0x00025564
DATA 4 0x021B001C 0x00000000
```
